<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - Smart Grocery Cart</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
    <header></header>

    <div class="container">
        <h2 style="margin-bottom: 2rem;">Shopping Cart</h2>

        <div style="display: grid; grid-template-columns: 1fr 350px; gap: 2rem; align-items: start;">
            <!-- Cart Items -->
            <div id="cart-items-container" class="card" style="padding: 1.5rem;">
                <div id="cart-empty" style="display: none; text-align: center; padding: 3rem 0;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ›’</div>
                    <h3>Your cart is empty</h3>
                    <p style="color: var(--text-muted);">Looks like you haven't added anything yet.</p>
                    <a href="products.html" class="btn btn-primary"
                        style="margin-top: 1rem; text-decoration: none;">Start Shopping</a>
                </div>
                <div id="cart-list"></div>
            </div>

            <!-- Summary Card -->
            <div id="cart-summary" class="card" style="padding: 1.5rem; position: sticky; top: 100px;">
                <h3 style="margin-top: 0; border-bottom: 1px solid var(--border); padding-bottom: 1rem;">Order Summary
                </h3>
                <div style="display: flex; justify-content: space-between; margin: 1.5rem 0;">
                    <span style="color: var(--text-muted);">Subtotal</span>
                    <span id="subtotal" style="font-weight: 600;">â‚¹0.00</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin: 1rem 0;">
                    <span style="color: var(--text-muted);">Shipping</span>
                    <span style="color: #10b981; font-weight: 600;">FREE</span>
                </div>
                <div
                    style="display: flex; justify-content: space-between; margin: 1.5rem 0; padding-top: 1rem; border-top: 1px solid var(--border); font-size: 1.25rem; font-weight: 800;">
                    <span>Total</span>
                    <span id="grand-total">â‚¹0.00</span>
                </div>
                <button class="btn btn-primary" style="width: 100%; height: 3.5rem; font-size: 1.125rem;"
                    onclick="checkout()">
                    Proceed to Checkout
                </button>
                <p style="font-size: 0.75rem; color: var(--text-muted); text-align: center; margin-top: 1rem;">
                    Secure transaction with cloud-native encryption.
                </p>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        const auth = UI.checkAuth();
        if (auth) {
            renderHeader();
            loadCart();
        }

        async function loadCart() {
            try {
                const res = await fetch(`${API.cart}/cart/${auth.user}`);
                const items = await res.json();
                const list = document.getElementById('cart-list');
                const empty = document.getElementById('cart-empty');
                const summary = document.getElementById('cart-summary');

                if (items.length === 0) {
                    list.style.display = 'none';
                    empty.style.display = 'block';
                    summary.style.display = 'none';
                    return;
                }

                list.style.display = 'block';
                empty.style.display = 'none';
                summary.style.display = 'block';

                list.innerHTML = items.map(i => `
                    <div style="display: flex; gap: 1.5rem; padding: 1.5rem 0; border-bottom: 1px solid var(--border);">
                        <div style="width: 100px; height: 100px; background: #f1f5f9; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; font-size: 2.5rem;">
                            ${getGroceryIcon(i.name)}
                        </div>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <h4 style="margin: 0; font-size: 1.125rem;">${i.name}</h4>
                                <div style="font-weight: 700;">â‚¹${(i.price * i.quantity).toFixed(2)}</div>
                            </div>
                            <p style="color: var(--text-muted); font-size: 0.875rem; margin: 0.5rem 0;">Qty: ${i.quantity} Ã— â‚¹${i.price.toFixed(2)}</p>
                            <button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.75rem; color: #ef4444; border-color: #fee2e2;" onclick="removeItem(${i.id})">
                                Remove Item
                            </button>
                        </div>
                    </div>
                `).join('');

                const total = items.reduce((sum, i) => sum + (i.price * i.quantity), 0);
                document.getElementById('subtotal').textContent = `â‚¹${total.toFixed(2)}`;
                document.getElementById('grand-total').textContent = `â‚¹${total.toFixed(2)}`;
            } catch (e) {
                console.error('Failed to load cart');
            }
        }

        async function removeItem(id) {
            await fetch(`${API.cart}/cart/${auth.user}/${id}`, { method: 'DELETE' });
            loadCart();
        }

        async function checkout() {
            try {
                const res = await fetch(`${API.cart}/cart/${auth.user}`);
                const items = await res.json();
                const total = items.reduce((sum, i) => sum + (i.price * i.quantity), 0);

                await fetch(API.orders + '/orders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user: auth.user, items, total })
                });

                await fetch(`${API.cart}/cart/${auth.user}`, { method: 'DELETE' });
                alert('Success! Your grocery order has been placed.');
                window.location.href = 'orders.html';
            } catch (e) {
                alert('Checkout failed. Please try again.');
            }
        }

        function getGroceryIcon(name) {
            if (name.includes('Vegetables')) return 'ğŸ¥¦';
            if (name.includes('Fruits')) return 'ğŸ';
            if (name.includes('Rice')) return 'ğŸŒ¾';
            if (name.includes('Milk')) return 'ğŸ¥›';
            if (name.includes('Oil')) return 'ğŸ§´';
            if (name.includes('Tomato')) return 'ğŸ…';
            if (name.includes('Potato')) return 'ğŸ¥”';
            if (name.includes('Flour')) return 'ğŸŒ¾';
            if (name.includes('Paneer')) return 'ğŸ§ˆ';
            if (name.includes('Curd')) return 'ğŸ¥›';
            if (name.includes('Almond')) return 'ğŸŒ°';
            if (name.includes('Cashew')) return 'ğŸ¥œ';
            if (name.includes('Tea')) return 'â˜•';
            if (name.includes('Coffee')) return 'â˜•';
            return 'ğŸ“¦';
        }
    </script>
</body>

</html>